---
title: "Version Control"
description: "Create agent versions, compare configurations, and roll back to previous states."
section: "agents"
order: 7
primaryKeyword: "AI agent versioning"
relatedSlugs: ["agents/creating-agents", "agents/configuration"]
pageType: "how-to"
---

# Version Control

Agent versioning creates immutable snapshots of your agent's configuration at specific points in time. Each version captures the complete state—instructions, model settings, tools, skills, guardrails, and metadata—enabling audit trails, safe experimentation, and rollback capabilities.

## Why version agents?

Version control provides three critical capabilities for production AI systems:

### 1. Audit trail

Every configuration change is recorded with:

- **Who made the change** (`createdBy`)
- **When it happened** (`createdAt`)
- **What changed** (`changeNotes`, `changesJson`)
- **Complete snapshot** (`snapshot` JSON)

This is essential for compliance, debugging production issues, and understanding how agent behavior evolved over time.

### 2. Safe rollback

If a change causes regressions or unexpected behavior, roll back to a known-good version instantly. No code deployments required—the rollback creates a new version from the previous snapshot.

### 3. A/B testing

Compare versions side-by-side to evaluate:

- Different instruction sets
- Model provider changes (OpenAI vs Anthropic)
- Tool combinations
- Temperature and other hyperparameters

Run both versions in parallel, compare metrics, and promote the winner.

<Callout type="tip">
    Versions are **immutable**—once created, they cannot be modified. This ensures historical
    accuracy and prevents accidental data loss.
</Callout>

## Creating versions

Create a version snapshot before making significant changes:

```bash
curl -X POST https://agentc2.ai/agent/api/agents/research-assistant/versions \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "changeNotes": "Initial production configuration with web-fetch tool and semantic recall"
  }'
```

The response includes the new version number:

```json
{
    "success": true,
    "version": {
        "id": "version-123",
        "version": 1,
        "description": "Initial production configuration with web-fetch tool and semantic recall",
        "modelProvider": "openai",
        "modelName": "gpt-4o",
        "createdAt": "2026-02-18T10:00:00Z",
        "createdBy": "user-456"
    }
}
```

<Callout type="info">
    Versions are automatically created when you update an agent via `PUT /api/agents/{id}` if the
    changes affect version-worthy fields (instructions, model, tools, skills, scorers). You can also
    create versions manually for milestone snapshots.
</Callout>

### Version numbering

Versions are auto-incremented integers starting at 1. The agent's `version` field tracks the current active version:

```json
{
  "agent": {
    "id": "agent-123",
    "slug": "research-assistant",
    "version": 3,  // Current active version
    ...
  }
}
```

## Listing versions

Retrieve version history with pagination:

```bash
curl "https://agentc2.ai/agent/api/agents/research-assistant/versions?limit=20&cursor=5" \
  -H "Authorization: Bearer $TOKEN"
```

Response includes version metadata and aggregated stats:

```json
{
    "success": true,
    "versions": [
        {
            "id": "version-123",
            "version": 3,
            "description": "Added Jira integration tools",
            "modelProvider": "openai",
            "modelName": "gpt-4o",
            "createdAt": "2026-02-18T14:00:00Z",
            "createdBy": "user-456",
            "versionStats": {
                "runs": 150,
                "successRate": 0.94,
                "avgQuality": 0.87
            },
            "isActive": true
        },
        {
            "id": "version-122",
            "version": 2,
            "description": "Switched to GPT-4o from Claude",
            "createdAt": "2026-02-17T09:00:00Z",
            "versionStats": {
                "runs": 45,
                "successRate": 0.91,
                "avgQuality": 0.82
            },
            "isActive": false
        }
    ],
    "hasMore": false,
    "nextCursor": null
}
```

<Callout type="info">
    Version stats (`runs`, `successRate`, `avgQuality`) are computed from `AgentRun` records that
    reference this version. Stats update automatically as new runs complete.
</Callout>

## Comparing versions

Compare any two versions to see what changed:

```bash
curl -X POST https://agentc2.ai/agent/api/agents/research-assistant/versions/compare \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "versionA": 2,
    "versionB": 3
  }'
```

The comparison returns a structured diff:

```json
{
    "success": true,
    "diff": {
        "instructions": {
            "changed": true,
            "old": "You are a research assistant...",
            "new": "You are an advanced research assistant with access to project management tools..."
        },
        "tools": {
            "added": ["jira_jira-create-issue", "jira_jira-search-issues"],
            "removed": [],
            "unchanged": ["web-fetch", "calculator"]
        },
        "modelName": {
            "changed": false,
            "value": "gpt-4o"
        },
        "temperature": {
            "changed": true,
            "old": 0.7,
            "new": 0.5
        }
    },
    "metrics": {
        "versionA": {
            "runs": 45,
            "successRate": 0.91,
            "avgQuality": 0.82
        },
        "versionB": {
            "runs": 150,
            "successRate": 0.94,
            "avgQuality": 0.87
        }
    }
}
```

Use comparisons to:

- **Understand impact** — See what changed between versions
- **Debug regressions** — Identify which change caused issues
- **Justify promotions** — Show metrics improvements

## Rolling back

Roll back to a previous version:

```bash
curl -X POST https://agentc2.ai/agent/api/agents/research-assistant/versions/2/rollback \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "reason": "Version 3 caused increased error rate in production"
  }'
```

Rollback:

1. Loads the snapshot from version 2
2. Creates a new version (version 4) with that configuration
3. Updates the agent to use the new version
4. Records an audit log entry

```json
{
    "success": true,
    "newVersion": {
        "id": "version-124",
        "version": 4,
        "description": "Rollback to version 2",
        "createdAt": "2026-02-18T16:00:00Z"
    },
    "previousVersion": 3,
    "rolledBackTo": 2
}
```

<Callout type="warning">
    Rollback creates a **new version**, not a reversion of the existing version. This preserves
    history and allows you to roll forward again if needed.
</Callout>

## AgentVersion model

Versions are stored in the `AgentVersion` table:

| Field           | Type     | Description                                             |
| --------------- | -------- | ------------------------------------------------------- |
| `id`            | String   | Unique identifier (CUID)                                |
| `agentId`       | String   | Foreign key to `Agent`                                  |
| `tenantId`      | String   | Organization ID (for multi-tenant isolation)            |
| `version`       | Int      | Version number (auto-incremented)                       |
| `description`   | String   | Human-readable change notes                             |
| `instructions`  | String   | Agent instructions at this version                      |
| `modelProvider` | String   | Model provider (`"openai"`, `"anthropic"`)              |
| `modelName`     | String   | Model name (`"gpt-4o"`, `"claude-sonnet-4-20250514"`)   |
| `changesJson`   | JSON     | Structured description of changes from previous version |
| `snapshot`      | JSON     | Complete agent configuration snapshot                   |
| `createdAt`     | DateTime | When the version was created                            |
| `createdBy`     | String   | User ID who created the version                         |

The `snapshot` field contains the full agent state:

```json
{
    "name": "Research Assistant",
    "description": "AI research assistant with web search",
    "instructions": "You are a research assistant...",
    "instructionsTemplate": null,
    "modelProvider": "openai",
    "modelName": "gpt-4o",
    "temperature": 0.3,
    "maxTokens": 4096,
    "modelConfig": null,
    "memoryEnabled": true,
    "memoryConfig": { "lastMessages": 20, "semanticRecall": { "topK": 3 } },
    "maxSteps": 10,
    "scorers": ["relevancy", "completeness"],
    "tools": [
        { "toolId": "web-fetch", "config": null },
        { "toolId": "calculator", "config": null }
    ],
    "skills": [{ "skillId": "research-assistant", "pinned": true }],
    "visibility": "PRIVATE",
    "metadata": {}
}
```

## Version discipline best practices

### 1. Version before major changes

Always create a version before:

- Changing instructions significantly
- Switching model providers
- Adding or removing tools
- Modifying guardrails
- Changing temperature or other hyperparameters

### 2. Write descriptive change notes

Good change notes explain **why** and **what**:

```
✅ "Switched to GPT-4o for better tool use accuracy"
✅ "Added Jira tools to enable project management workflows"
✅ "Reduced temperature from 0.7 to 0.3 for more consistent research outputs"
```

Avoid vague notes:

```
❌ "Updated agent"
❌ "Fixed bugs"
❌ "Changes"
```

### 3. Use versions for experiments

Create a version, make experimental changes, test, then either:

- **Promote** — Create a new version with the experimental config
- **Rollback** — Revert to the previous version

This keeps production stable while enabling safe experimentation.

### 4. Compare before promoting

Always compare versions before promoting to production:

```bash
# Compare experimental version to current production
curl -X POST https://agentc2.ai/agent/api/agents/research-assistant/versions/compare \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "versionA": 3,  # Current production
    "versionB": 4   # Experimental
  }'
```

Review the diff and metrics to ensure the change improves quality.

### 5. Monitor version performance

Track version stats to identify regressions early:

```bash
# Check version stats
curl https://agentc2.ai/agent/api/agents/research-assistant/versions \
  -H "Authorization: Bearer $TOKEN"
```

Look for:

- **Decreasing success rate** — May indicate a regression
- **Lower average quality** — Instructions or model change may have hurt performance
- **Fewer runs** — Users may be avoiding the new version

### 6. Archive old versions

Versions are permanent by default, but you can mark them as archived for organizational purposes. Consider archiving versions older than 6 months that are no longer relevant.

## Version stats and metrics

Each version tracks aggregated performance metrics:

| Metric        | Description                                 | Use Case               |
| ------------- | ------------------------------------------- | ---------------------- |
| `runs`        | Total number of runs using this version     | Volume tracking        |
| `successRate` | Percentage of successful runs (no errors)   | Reliability monitoring |
| `avgQuality`  | Average evaluation score across all scorers | Quality assessment     |

Stats are computed from `AgentRun` records that reference the version via `versionId`. They update automatically as new runs complete.

<Callout type="tip">
    Use version stats to make data-driven decisions about which configurations perform best. Compare
    versions side-by-side to identify winning configurations.
</Callout>

## Related topics

- **[Creating Agents](/docs/agents/creating-agents)** — Learn how to create your first agent
- **[Agent Configuration](/docs/agents/configuration)** — Understand all configuration options
- **[Budgets and Costs](/docs/agents/budgets-and-costs)** — Track costs per version
- **[Evaluations](/docs/agents/evaluations)** — Score versions with automated evaluators
